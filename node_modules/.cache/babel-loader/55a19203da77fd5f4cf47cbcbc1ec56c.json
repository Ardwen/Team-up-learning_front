{"ast":null,"code":"import _slicedToArray from\"/Users/owner/Desktop/teamapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/owner/Desktop/teamapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject4(){var data=_taggedTemplateLiteral([\"\\n  height: 50%;\\n  width: 100%;\\n  border: 1px solid black;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  height: 100%;\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  width: 40%;\\n  height: 100%;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  width: 100%;\\n  height: 100vh;\\n  flex-direction: row;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useEffect,useState,useRef}from\"react\";import io from\"socket.io-client\";import Peer from\"simple-peer\";import styled from\"styled-components\";import{YOUR_API_KEY}from'../Utils/Authentication.js';import axios from\"axios\";var Container=styled.div(_templateObject());var LeftRow=styled.div(_templateObject2());var RightRow=styled.div(_templateObject3());var Video=styled.video(_templateObject4());var Room=function Room(props){var socketRef=useRef();var userVideoRef=useRef();var partnerVideo=useRef();var peerRef=useRef();var VideoPlayer=useRef();//const [inputvalue, setInputvalue] = useState(\"\");\nvar _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),videoID=_useState2[0],setVideoID=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),videohost=_useState4[0],setVideohost=_useState4[1];function createPeer(partnerID,callerID,stream){var peer=new Peer({initiator:true,trickle:false,stream:stream});peer.on(\"signal\",function(signal){var payload={partnerID:partnerID,callerID:callerID,signal:signal};socketRef.current.emit(\"call partner\",payload);});peer.on(\"stream\",handleStream);peer.on(\"data\",handleData);return peer;}function addPeer(incomingSignal,callerID,stream){var peer=new Peer({initiator:false,trickle:false,stream:stream});peer.on(\"signal\",function(signal){var payload={callerID:callerID,signal:signal};socketRef.current.emit(\"accept call\",payload);});peer.on(\"stream\",handleStream);peer.on(\"data\",handleData);peer.signal(incomingSignal);return peer;}useEffect(function(){navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(function(stream){userVideoRef.current.srcObject=stream;socketRef.current=io.connect('https://backendteamlearning.herokuapp.com/',{'sync disconnect on unload':true});//http://ec2-3-17-9-85.us-east-2.compute.amazonaws.com:5000/\nsocketRef.current.emit(\"join room\",props.match.params.roomID);socketRef.current.on(\"other user\",function(partnerID){if(partnerID){peerRef.current=createPeer(partnerID,socketRef.current.id,stream);}});socketRef.current.on(\"caller signal\",function(incoming){peerRef.current=addPeer(incoming.signal,incoming.callerID,stream);});socketRef.current.on(\"callee signal\",function(signal){peerRef.current.signal(signal);});socketRef.current.on(\"room full\",function(){alert(\"room is full\");});});},[props.match.params.roomID]);function handlePanopto(){var firstScriptTag=document.getElementsByTagName('script')[0];var tag=document.createElement(\"script\");tag.src=\"https://developers.panopto.com/scripts/embedapi.min.js\";firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);window.onPanoptoEmbedApiReady=onPanoptoEmbedApiReady;}function handleYoutube(){var tag=document.createElement(\"script\");tag.src=\"https://www.youtube.com/iframe_api\";var firstScriptTag=document.getElementsByTagName('script')[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);window.onYouTubeIframeAPIReady=loadVideoPlayer;}function onPanoptoEmbedApiReady(){var player=new window.EmbedApi(\"player\",{width:\"640\",height:\"390\",//This is the URL of your Panopto site\nserverName:\"uncch.hosted.panopto.com\",sessionId:videoID,videoParams:{// Optional parameters\n//interactivity parameter controls if the user sees table of contents, discussions, notes, & in-video search\n\"interactivity\":\"none\",\"showtitle\":\"false\"},events:{\"onIframeReady\":onPanoptoIframeReady,\"onReady\":onPanoptoVideoReady,\"onStateChange\":onPanoptoStateUpdate}});VideoPlayer.current=player;}function onPanoptoIframeReady(){VideoPlayer.current.loadVideo();}//The API will call this function when the video player is ready\nfunction onPanoptoVideoReady(){VideoPlayer.current.seekTo(100);}//The API calls this function when a player state change happens\nfunction onPanoptoStateUpdate(state){VideoPlayer.current.setVolume(0.3);VideoPlayer.current.setPlaybackRate(2);}function loadVideoPlayer(){var player=new window.YT.Player(\"player\",{height:\"390\",width:\"640\",videoId:videoID});VideoPlayer.current=player;}function stopVideo(){try{peerRef.current.send(JSON.stringify({type:\"pause\"}));}catch(err){}VideoPlayer.current.pauseVideo();}function playVideo(){try{peerRef.current.send(JSON.stringify({type:\"play\"}));}catch(err){}VideoPlayer.current.playVideo();}function handleVideo(){document.getElementsByTagName('input')[0].remove();document.getElementById('loadVideo').remove();if(videohost==\"y\"){handleYoutube();}else{handlePanopto();}var play=document.createElement(\"button\");play.innerHTML=\"Play Video\";play.addEventListener(\"click\",playVideo);var stop=document.createElement(\"button\");stop.innerHTML=\"Stop Video\";stop.addEventListener(\"click\",stopVideo);var div=document.getElementById(\"controls\");div.appendChild(play);div.appendChild(stop);axios.get(\"https://youtube.googleapis.com/youtube/v3/videos?part=snippet%2CcontentDetails%2Cstatistics&id=\".concat(videoID,\"&key=\").concat(YOUR_API_KEY)).then(function(response){console.log(response.data);var title=response.data.items[0].snippet.title;var description=response.data.items[0].snippet.description;document.getElementById(\"videoTitle\").innerHTML=title;document.getElementById(\"videoDescription\").innerHTML=description;}).catch(function(err){return console.log(err);});}function loadVideo(){if(videohost==''){alert(\"please select video player first\");return;}if(videoID==''){alert(\"please upload video id\");return;}try{peerRef.current.send(JSON.stringify({type:\"newVideo\",host:videohost,data:videoID}));}catch(err){}handleVideo();}useEffect(function(){if(videohost=='y'){document.getElementById('YT').style.backgroundColor=\"#666666\";document.getElementById('PT').style.backgroundColor=\"#668cff\";}else if(videohost=='n'){document.getElementById('YT').style.backgroundColor=\"#668cff\";document.getElementById('PT').style.backgroundColor=\"#666666\";}},[videohost]);function ClickYoutube(e){setVideohost(\"y\");}function ClickPT(e){setVideohost(\"n\");}function handleStream(stream){partnerVideo.current.srcObject=stream;}function handleData(data){var parsed=JSON.parse(data);if(parsed.type===\"newVideo\"){setVideohost(parsed.host);setVideoID(parsed.data);}else if(parsed.type===\"pause\"){VideoPlayer.current.pauseVideo();}else{VideoPlayer.current.playVideo();}}return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(LeftRow,null,/*#__PURE__*/React.createElement(Video,{muted:true,autoPlay:true,ref:userVideoRef}),/*#__PURE__*/React.createElement(Video,{muted:true,autoPlay:true,ref:partnerVideo})),/*#__PURE__*/React.createElement(RightRow,null,/*#__PURE__*/React.createElement(\"div\",{id:\"host\"},/*#__PURE__*/React.createElement(\"button\",{id:\"PT\",backgroundColor:\"#668cff\",onClick:ClickPT},\"Panopto\"),/*#__PURE__*/React.createElement(\"button\",{id:\"YT\",backgroundColor:\"#668cff\",onClick:ClickYoutube},\"Youtube\")),/*#__PURE__*/React.createElement(\"div\",{id:\"player\"}),/*#__PURE__*/React.createElement(\"div\",{id:\"controls\"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",placeholder:\"video link\",value:videoID,onChange:function onChange(e){return setVideoID(e.target.value);}}),/*#__PURE__*/React.createElement(\"button\",{id:\"loadVideo\",onClick:loadVideo},\"Load video\")),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h3\",{id:\"videoTitle\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"p\",{id:\"videoDescription\"}))));};export default Room;","map":{"version":3,"sources":["/Users/owner/Desktop/teamapp/src/View/CourseRoomView.js"],"names":["React","useEffect","useState","useRef","io","Peer","styled","YOUR_API_KEY","axios","Container","div","LeftRow","RightRow","Video","video","Room","props","socketRef","userVideoRef","partnerVideo","peerRef","VideoPlayer","videoID","setVideoID","videohost","setVideohost","createPeer","partnerID","callerID","stream","peer","initiator","trickle","on","signal","payload","current","emit","handleStream","handleData","addPeer","incomingSignal","navigator","mediaDevices","getUserMedia","audio","then","srcObject","connect","match","params","roomID","id","incoming","alert","handlePanopto","firstScriptTag","document","getElementsByTagName","tag","createElement","src","parentNode","insertBefore","window","onPanoptoEmbedApiReady","handleYoutube","onYouTubeIframeAPIReady","loadVideoPlayer","player","EmbedApi","width","height","serverName","sessionId","videoParams","events","onPanoptoIframeReady","onPanoptoVideoReady","onPanoptoStateUpdate","loadVideo","seekTo","state","setVolume","setPlaybackRate","YT","Player","videoId","stopVideo","send","JSON","stringify","type","err","pauseVideo","playVideo","handleVideo","remove","getElementById","play","innerHTML","addEventListener","stop","appendChild","get","response","console","log","data","title","items","snippet","description","catch","host","style","backgroundColor","ClickYoutube","e","ClickPT","parsed","parse","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\nimport {YOUR_API_KEY} from '../Utils/Authentication.js';\nimport axios from \"axios\";\n\nconst Container = styled.div`\n  display: flex;\n  width: 100%;\n  height: 100vh;\n  flex-direction: row;\n`;\n\nconst LeftRow = styled.div`\n  width: 40%;\n  height: 100%;\n`;\n\nconst RightRow = styled.div`\n  flex: 1;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nconst Video = styled.video`\n  height: 50%;\n  width: 100%;\n  border: 1px solid black;\n`;\n\nconst Room = (props) => {\n  const socketRef = useRef();\n  const userVideoRef = useRef();\n  const partnerVideo = useRef();\n  const peerRef = useRef();\n  const VideoPlayer = useRef();\n  //const [inputvalue, setInputvalue] = useState(\"\");\n  const [videoID, setVideoID] = useState(\"\");\n  const [videohost, setVideohost] = useState(\"\");\n\n  function createPeer(partnerID, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream\n    });\n\n    peer.on(\"signal\", (signal) => {\n      const payload = {\n        partnerID,\n        callerID,\n        signal\n      };\n      socketRef.current.emit(\"call partner\", payload);\n    });\n\n    peer.on(\"stream\", handleStream);\n    peer.on(\"data\", handleData);\n\n    return peer;\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream\n    });\n\n    peer.on(\"signal\", (signal) => {\n      const payload = {\n        callerID,\n        signal\n      };\n      socketRef.current.emit(\"accept call\", payload);\n    });\n\n    peer.on(\"stream\", handleStream);\n    peer.on(\"data\", handleData);\n\n    peer.signal(incomingSignal);\n    return peer;\n  }\n\n  useEffect(() => {\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        userVideoRef.current.srcObject = stream;\n        socketRef.current = io.connect('https://backendteamlearning.herokuapp.com/',{\n  'sync disconnect on unload':true\n});\n        //http://ec2-3-17-9-85.us-east-2.compute.amazonaws.com:5000/\n        socketRef.current.emit(\"join room\", props.match.params.roomID);\n\n        socketRef.current.on(\"other user\", (partnerID) => {\n          if (partnerID) {\n            peerRef.current = createPeer(\n              partnerID,\n              socketRef.current.id,\n              stream\n            );\n          }\n        });\n\n        socketRef.current.on(\"caller signal\", (incoming) => {\n          peerRef.current = addPeer(incoming.signal, incoming.callerID, stream);\n        });\n\n        socketRef.current.on(\"callee signal\", (signal) => {\n          peerRef.current.signal(signal);\n        });\n\n        socketRef.current.on(\"room full\", () => {\n          alert(\"room is full\");\n        });\n      });\n  }, [props.match.params.roomID]);\n\n\n  function handlePanopto() {\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }\n\n  function handleYoutube() {\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://www.youtube.com/iframe_api\";\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onYouTubeIframeAPIReady = loadVideoPlayer;\n  }\n\n  function onPanoptoEmbedApiReady(){\n            const player = new window.EmbedApi(\"player\", {\n                width: \"640\",\n                height: \"390\",\n                //This is the URL of your Panopto site\n                serverName: \"uncch.hosted.panopto.com\",\n                sessionId: videoID,\n                videoParams: { // Optional parameters\n                //interactivity parameter controls if the user sees table of contents, discussions, notes, & in-video search\n                    \"interactivity\": \"none\",\n                    \"showtitle\": \"false\"\n                },\n                events: {\n                    \"onIframeReady\": onPanoptoIframeReady,\n                    \"onReady\": onPanoptoVideoReady,\n                    \"onStateChange\": onPanoptoStateUpdate\n                }\n            });\n            VideoPlayer.current = player;\n  }\n\n  function onPanoptoIframeReady()\n  {\n    VideoPlayer.current.loadVideo();\n  }\n\n    //The API will call this function when the video player is ready\n  function onPanoptoVideoReady()\n  {\n      VideoPlayer.current.seekTo(100);\n  }\n\n  //The API calls this function when a player state change happens\n   function onPanoptoStateUpdate(state)\n  {\n          VideoPlayer.current.setVolume(0.3);\n          VideoPlayer.current.setPlaybackRate(2);\n  }\n\n  function loadVideoPlayer() {\n    const player = new window.YT.Player(\"player\", {\n      height: \"390\",\n      width: \"640\",\n      videoId: videoID\n    });\n\n    VideoPlayer.current = player;\n  }\n\n  function stopVideo() {\n    try {\n          peerRef.current.send(JSON.stringify({ type: \"pause\" }));\n      }\n      catch(err) {\n      }\n    VideoPlayer.current.pauseVideo();\n  }\n\n  function playVideo() {\n    try {\n        peerRef.current.send(JSON.stringify({ type: \"play\" }));\n      }\n      catch(err) {\n      }\n    VideoPlayer.current.playVideo();\n  }\n\n  function handleVideo(){\n    document.getElementsByTagName('input')[0].remove();\n    document.getElementById('loadVideo').remove();\n    if(videohost==\"y\"){\n      handleYoutube();\n    } else {\n      handlePanopto();\n    }\n    var play= document.createElement(\"button\");\n    play.innerHTML = \"Play Video\";\n    play.addEventListener (\"click\", playVideo);\n    var stop= document.createElement(\"button\");\n    stop.innerHTML = \"Stop Video\";\n    stop.addEventListener (\"click\", stopVideo);\n    var div = document.getElementById(\"controls\");\n    div.appendChild(play);\n    div.appendChild(stop);\n    axios.get(`https://youtube.googleapis.com/youtube/v3/videos?part=snippet%2CcontentDetails%2Cstatistics&id=${videoID}&key=${YOUR_API_KEY}`)\n      .then((response)=>{\n        console.log(response.data);\n        let title = response.data.items[0].snippet.title;\n        let description=response.data.items[0].snippet.description;\n        document.getElementById(\"videoTitle\").innerHTML=title;\n        document.getElementById(\"videoDescription\").innerHTML=description;\n      }).catch(err=>console.log(err));\n  }\n\n  function loadVideo() {\n    if(videohost==''){\n      alert(\"please select video player first\");\n      return;\n    }\n    if(videoID==''){\n      alert(\"please upload video id\");\n      return;\n    }\n    try {\n        peerRef.current.send(JSON.stringify({ type: \"newVideo\",host:videohost, data: videoID }));\n      }\n      catch(err) {\n    }\n    handleVideo();\n  }\n\n  useEffect(() => {\n    if(videohost=='y'){\n      document.getElementById('YT').style.backgroundColor=\"#666666\";\n      document.getElementById('PT').style.backgroundColor=\"#668cff\";\n    }else if(videohost=='n'){\n      document.getElementById('YT').style.backgroundColor=\"#668cff\";\n      document.getElementById('PT').style.backgroundColor=\"#666666\";\n    }\n  },[videohost])\n\n\n  function ClickYoutube(e){\n    setVideohost(\"y\");\n  }\n\n  function ClickPT(e){\n    setVideohost(\"n\");\n  }\n\n\n  function handleStream(stream) {\n    partnerVideo.current.srcObject = stream;\n  }\n\n\n  function handleData(data) {\n    const parsed = JSON.parse(data);\n    if (parsed.type === \"newVideo\") {\n      setVideohost(parsed.host);\n      setVideoID(parsed.data);\n    } else if (parsed.type === \"pause\") {\n      VideoPlayer.current.pauseVideo();\n    } else {\n      VideoPlayer.current.playVideo();\n    }\n  }\n\n  return (\n    <Container>\n      <LeftRow>\n        <Video muted autoPlay ref={userVideoRef} />\n        <Video muted autoPlay ref={partnerVideo} />\n      </LeftRow>\n      <RightRow>\n        <div id = \"host\">\n        <button id=\"PT\" backgroundColor=\"#668cff\" onClick={ClickPT}>Panopto</button>\n        <button id=\"YT\" backgroundColor=\"#668cff\" onClick={ClickYoutube}>Youtube</button>\n        </div>\n        <div id=\"player\" />\n        <div id=\"controls\">\n        <input type=\"text\" placeholder=\"video link\" value={videoID} onChange={e => setVideoID(e.target.value)} />\n        <button id =\"loadVideo\" onClick={loadVideo}>Load video</button>\n        </div>\n        <div>\n        <h3 id=\"videoTitle\"></h3>\n        <br/>\n        <p id=\"videoDescription\"></p>\n        </div>\n\n      </RightRow>\n    </Container>\n  );\n};\n\nexport default Room;\n"]},"metadata":{},"sourceType":"module"}