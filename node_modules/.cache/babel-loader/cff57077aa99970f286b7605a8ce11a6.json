{"ast":null,"code":"var _jsxFileName = \"/Users/owner/Desktop/Team-up-learning_front/src/View/CourseRoomView.js\";\nimport React, { useEffect, useState, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\nconst Container = styled.div`\n  display: flex;\n  width: 100%;\n  height: 100vh;\n  flex-direction: row;\n`;\nconst LeftRow = styled.div`\n  width: 40%;\n  height: 100%;\n`;\nconst RightRow = styled.div`\n  flex: 1;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\nconst Video = styled.video`\n  height: 50%;\n  width: 100%;\n  border: 1px solid black;\n`;\n\nconst Room = props => {\n  const socketRef = useRef();\n  const userVideoRef = useRef();\n  const partnerVideo = useRef();\n  const peerRef = useRef();\n  const VideoPlayer = useRef(); //const [videoID, setVideoID] = useState(\"\");\n  //const [videohost, setVideohost] = useState(\"\");\n\n  let videoID = \"\";\n  let videohost = \"\";\n\n  function createPeer(partnerID, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream\n    });\n    peer.on(\"signal\", signal => {\n      const payload = {\n        partnerID,\n        callerID,\n        signal\n      };\n      socketRef.current.emit(\"call partner\", payload);\n    });\n    peer.on(\"stream\", handleStream);\n    peer.on(\"data\", handleData);\n    return peer;\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream\n    });\n    peer.on(\"signal\", signal => {\n      const payload = {\n        callerID,\n        signal\n      };\n      socketRef.current.emit(\"accept call\", payload);\n    });\n    peer.on(\"stream\", handleStream);\n    peer.on(\"data\", handleData);\n    peer.signal(incomingSignal);\n    return peer;\n  }\n\n  useEffect(() => {\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      userVideoRef.current.srcObject = stream;\n      socketRef.current = io.connect('http://localhost:5000/');\n      socketRef.current.emit(\"join room\", props.match.params.roomID);\n      socketRef.current.on(\"other user\", partnerID => {\n        if (partnerID) {\n          peerRef.current = createPeer(partnerID, socketRef.current.id, stream);\n        }\n      });\n      socketRef.current.on(\"caller signal\", incoming => {\n        peerRef.current = addPeer(incoming.signal, incoming.callerID, stream);\n      });\n      socketRef.current.on(\"callee signal\", signal => {\n        peerRef.current.signal(signal);\n      });\n      socketRef.current.on(\"room full\", () => {\n        alert(\"room is full\");\n      });\n    });\n  }, [props.match.params.roomID]);\n\n  function handlePanopto() {\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }\n\n  function handleYoutube() {\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://www.youtube.com/iframe_api\";\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onYouTubeIframeAPIReady = loadVideoPlayer;\n  }\n\n  function onPanoptoEmbedApiReady() {\n    const player = new window.EmbedApi(\"player\", {\n      width: \"640\",\n      height: \"390\",\n      //This is the URL of your Panopto site\n      serverName: \"uncch.hosted.panopto.com\",\n      sessionId: videoID,\n      videoParams: {\n        // Optional parameters\n        //interactivity parameter controls if the user sees table of contents, discussions, notes, & in-video search\n        \"interactivity\": \"none\",\n        \"showtitle\": \"false\"\n      },\n      events: {\n        \"onIframeReady\": onPanoptoIframeReady,\n        \"onReady\": onPanoptoVideoReady,\n        \"onStateChange\": onPanoptoStateUpdate\n      }\n    });\n    VideoPlayer.current = player;\n  }\n\n  function onPanoptoIframeReady() {\n    VideoPlayer.current.loadVideo();\n  } //The API will call this function when the video player is ready\n\n\n  function onPanoptoVideoReady() {\n    VideoPlayer.current.seekTo(100);\n  } //The API calls this function when a player state change happens\n\n\n  function onPanoptoStateUpdate(state) {\n    VideoPlayer.current.setVolume(0.3);\n    VideoPlayer.current.setPlaybackRate(2);\n  }\n\n  function loadVideoPlayer() {\n    const player = new window.YT.Player(\"player\", {\n      height: \"390\",\n      width: \"640\",\n      videoId: videoID\n    });\n    VideoPlayer.current = player;\n  }\n\n  function stopVideo() {\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"pause\"\n      }));\n    } catch (err) {}\n\n    VideoPlayer.current.pauseVideo();\n  }\n\n  function playVideo() {\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"play\"\n      }));\n    } catch (err) {}\n\n    VideoPlayer.current.playVideo();\n  }\n\n  function handleVideo() {\n    document.getElementsByTagName('input')[0].remove();\n    document.getElementById('loadVideo').remove();\n\n    if (videohost == \"y\") {\n      handleYoutube();\n    } else {\n      handlePanopto();\n    }\n\n    var play = document.createElement(\"button\");\n    play.innerHTML = \"Play Video\";\n    play.addEventListener(\"click\", playVideo);\n    var stop = document.createElement(\"button\");\n    stop.innerHTML = \"Stop Video\";\n    stop.addEventListener(\"click\", stopVideo);\n    var div = document.getElementById(\"controls\");\n    div.appendChild(play);\n    div.appendChild(stop);\n  }\n\n  function loadVideo() {\n    if (videohost == '') {\n      alert(\"please select video player first\");\n      return;\n    }\n\n    if (videoID == '') {\n      alert(\"please upload video id\");\n      return;\n    }\n\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"newVideo\",\n        host: videohost,\n        data: videoID\n      }));\n    } catch (err) {}\n\n    handleVideo();\n  }\n\n  function ClickYoutube(e) {\n    //setVideohost(\"y\");\n    videohost = \"y\";\n    document.getElementById('YT').style.backgroundColor = \"#666666\";\n    document.getElementById('PT').style.backgroundColor = \"#668cff\";\n  }\n\n  function ClickPT(e) {\n    //setVideohost(\"n\");\n    videohost = \"n\";\n    document.getElementById('YT').style.backgroundColor = \"#668cff\";\n    document.getElementById('PT').style.backgroundColor = \"#666666\";\n  }\n\n  function handleStream(stream) {\n    partnerVideo.current.srcObject = stream;\n  }\n\n  function handleData(data) {\n    const parsed = JSON.parse(data);\n\n    if (parsed.type === \"newVideo\") {\n      //setVideohost(parsed.host);\n      //setVideoID(parsed.data);\n      videohost = parsed.host;\n      videoID = parsed.data;\n      handleVideo();\n    } else if (parsed.type === \"pause\") {\n      VideoPlayer.current.pauseVideo();\n    } else {\n      VideoPlayer.current.playVideo();\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(LeftRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Video, {\n    muted: true,\n    autoPlay: true,\n    ref: userVideoRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Video, {\n    muted: true,\n    autoPlay: true,\n    ref: partnerVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(RightRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    id: \"host\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    id: \"PT\",\n    backgroundColor: \"#668cff\",\n    onClick: ClickPT,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 9\n    }\n  }, \"Panopto\"), /*#__PURE__*/React.createElement(\"button\", {\n    id: \"YT\",\n    backgroundColor: \"#668cff\",\n    onClick: ClickYoutube,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 9\n    }\n  }, \"Youtube\")), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"player\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"controls\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"video link\",\n    value: videoID,\n    onChange: e => {\n      videoID = e.target.value;\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    id: \"loadVideo\",\n    onClick: loadVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 9\n    }\n  }, \"Load video\"))));\n};\n\nexport default Room;","map":{"version":3,"sources":["/Users/owner/Desktop/Team-up-learning_front/src/View/CourseRoomView.js"],"names":["React","useEffect","useState","useRef","io","Peer","styled","Container","div","LeftRow","RightRow","Video","video","Room","props","socketRef","userVideoRef","partnerVideo","peerRef","VideoPlayer","videoID","videohost","createPeer","partnerID","callerID","stream","peer","initiator","trickle","on","signal","payload","current","emit","handleStream","handleData","addPeer","incomingSignal","navigator","mediaDevices","getUserMedia","audio","then","srcObject","connect","match","params","roomID","id","incoming","alert","handlePanopto","firstScriptTag","document","getElementsByTagName","tag","createElement","src","parentNode","insertBefore","window","onPanoptoEmbedApiReady","handleYoutube","onYouTubeIframeAPIReady","loadVideoPlayer","player","EmbedApi","width","height","serverName","sessionId","videoParams","events","onPanoptoIframeReady","onPanoptoVideoReady","onPanoptoStateUpdate","loadVideo","seekTo","state","setVolume","setPlaybackRate","YT","Player","videoId","stopVideo","send","JSON","stringify","type","err","pauseVideo","playVideo","handleVideo","remove","getElementById","play","innerHTML","addEventListener","stop","appendChild","host","data","ClickYoutube","e","style","backgroundColor","ClickPT","parsed","parse","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\n\nconst Container = styled.div`\n  display: flex;\n  width: 100%;\n  height: 100vh;\n  flex-direction: row;\n`;\n\nconst LeftRow = styled.div`\n  width: 40%;\n  height: 100%;\n`;\n\nconst RightRow = styled.div`\n  flex: 1;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nconst Video = styled.video`\n  height: 50%;\n  width: 100%;\n  border: 1px solid black;\n`;\n\nconst Room = (props) => {\n  const socketRef = useRef();\n  const userVideoRef = useRef();\n  const partnerVideo = useRef();\n  const peerRef = useRef();\n  const VideoPlayer = useRef();\n  //const [videoID, setVideoID] = useState(\"\");\n  //const [videohost, setVideohost] = useState(\"\");\n  let videoID=\"\";\n  let videohost=\"\";\n\n  function createPeer(partnerID, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream\n    });\n\n    peer.on(\"signal\", (signal) => {\n      const payload = {\n        partnerID,\n        callerID,\n        signal\n      };\n      socketRef.current.emit(\"call partner\", payload);\n    });\n\n    peer.on(\"stream\", handleStream);\n    peer.on(\"data\", handleData);\n\n    return peer;\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream\n    });\n\n    peer.on(\"signal\", (signal) => {\n      const payload = {\n        callerID,\n        signal\n      };\n      socketRef.current.emit(\"accept call\", payload);\n    });\n\n    peer.on(\"stream\", handleStream);\n    peer.on(\"data\", handleData);\n\n    peer.signal(incomingSignal);\n    return peer;\n  }\n\n  useEffect(() => {\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        userVideoRef.current.srcObject = stream;\n        socketRef.current = io.connect('http://localhost:5000/');\n        socketRef.current.emit(\"join room\", props.match.params.roomID);\n\n        socketRef.current.on(\"other user\", (partnerID) => {\n          if (partnerID) {\n            peerRef.current = createPeer(\n              partnerID,\n              socketRef.current.id,\n              stream\n            );\n          }\n        });\n\n        socketRef.current.on(\"caller signal\", (incoming) => {\n          peerRef.current = addPeer(incoming.signal, incoming.callerID, stream);\n        });\n\n        socketRef.current.on(\"callee signal\", (signal) => {\n          peerRef.current.signal(signal);\n        });\n\n        socketRef.current.on(\"room full\", () => {\n          alert(\"room is full\");\n        });\n      });\n  }, [props.match.params.roomID]);\n\n\n  function handlePanopto() {\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }\n\n  function handleYoutube() {\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://www.youtube.com/iframe_api\";\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onYouTubeIframeAPIReady = loadVideoPlayer;\n  }\n\n  function onPanoptoEmbedApiReady(){\n            const player = new window.EmbedApi(\"player\", {\n                width: \"640\",\n                height: \"390\",\n                //This is the URL of your Panopto site\n                serverName: \"uncch.hosted.panopto.com\",\n                sessionId: videoID,\n                videoParams: { // Optional parameters\n                //interactivity parameter controls if the user sees table of contents, discussions, notes, & in-video search\n                    \"interactivity\": \"none\",\n                    \"showtitle\": \"false\"\n                },\n                events: {\n                    \"onIframeReady\": onPanoptoIframeReady,\n                    \"onReady\": onPanoptoVideoReady,\n                    \"onStateChange\": onPanoptoStateUpdate\n                }\n            });\n            VideoPlayer.current = player;\n  }\n\n  function onPanoptoIframeReady()\n  {\n    VideoPlayer.current.loadVideo();\n  }\n\n    //The API will call this function when the video player is ready\n  function onPanoptoVideoReady()\n  {\n      VideoPlayer.current.seekTo(100);\n  }\n\n  //The API calls this function when a player state change happens\n   function onPanoptoStateUpdate(state)\n  {\n          VideoPlayer.current.setVolume(0.3);\n          VideoPlayer.current.setPlaybackRate(2);\n  }\n\n  function loadVideoPlayer() {\n    const player = new window.YT.Player(\"player\", {\n      height: \"390\",\n      width: \"640\",\n      videoId: videoID\n    });\n\n    VideoPlayer.current = player;\n  }\n\n  function stopVideo() {\n    try {\n          peerRef.current.send(JSON.stringify({ type: \"pause\" }));\n      }\n      catch(err) {\n      }\n    VideoPlayer.current.pauseVideo();\n  }\n\n  function playVideo() {\n    try {\n        peerRef.current.send(JSON.stringify({ type: \"play\" }));\n      }\n      catch(err) {\n      }\n    VideoPlayer.current.playVideo();\n  }\n\n  function handleVideo(){\n    document.getElementsByTagName('input')[0].remove();\n    document.getElementById('loadVideo').remove();\n    if(videohost==\"y\"){\n      handleYoutube();\n    } else {\n      handlePanopto();\n    }\n    var play= document.createElement(\"button\");\n    play.innerHTML = \"Play Video\";\n    play.addEventListener (\"click\", playVideo);\n    var stop= document.createElement(\"button\");\n    stop.innerHTML = \"Stop Video\";\n    stop.addEventListener (\"click\", stopVideo);\n    var div = document.getElementById(\"controls\");\n    div.appendChild(play);\n    div.appendChild(stop);\n  }\n\n  function loadVideo() {\n    if(videohost==''){\n      alert(\"please select video player first\");\n      return;\n    }\n    if(videoID==''){\n      alert(\"please upload video id\");\n      return;\n    }\n    try {\n        peerRef.current.send(JSON.stringify({ type: \"newVideo\",host:videohost, data: videoID }));\n      }\n      catch(err) {\n    }\n    handleVideo();\n  }\n\n\n  function ClickYoutube(e){\n    //setVideohost(\"y\");\n    videohost=\"y\";\n    document.getElementById('YT').style.backgroundColor=\"#666666\";\n    document.getElementById('PT').style.backgroundColor=\"#668cff\";\n  }\n\n  function ClickPT(e){\n    //setVideohost(\"n\");\n    videohost=\"n\";\n    document.getElementById('YT').style.backgroundColor=\"#668cff\";\n    document.getElementById('PT').style.backgroundColor=\"#666666\";\n  }\n\n\n  function handleStream(stream) {\n    partnerVideo.current.srcObject = stream;\n  }\n\n  function handleData(data) {\n    const parsed = JSON.parse(data);\n    if (parsed.type === \"newVideo\") {\n      //setVideohost(parsed.host);\n      //setVideoID(parsed.data);\n      videohost=parsed.host;\n      videoID=parsed.data;\n      handleVideo();\n    } else if (parsed.type === \"pause\") {\n      VideoPlayer.current.pauseVideo();\n    } else {\n      VideoPlayer.current.playVideo();\n    }\n  }\n\n  return (\n    <Container>\n      <LeftRow>\n        <Video muted autoPlay ref={userVideoRef} />\n        <Video muted autoPlay ref={partnerVideo} />\n      </LeftRow>\n      <RightRow>\n        <div id = \"host\">\n        <button id=\"PT\" backgroundColor=\"#668cff\" onClick={ClickPT}>Panopto</button>\n        <button id=\"YT\" backgroundColor=\"#668cff\" onClick={ClickYoutube}>Youtube</button>\n        </div>\n        <div id=\"player\" />\n        <div id=\"controls\">\n        <input\n          type=\"text\"\n          placeholder=\"video link\"\n          value={videoID}\n          onChange={(e) => {videoID=e.target.value}}\n        />\n        <button id =\"loadVideo\" onClick={loadVideo}>Load video</button>\n        </div>\n      </RightRow>\n    </Container>\n  );\n};\n\nexport default Room;\n"]},"metadata":{},"sourceType":"module"}