{"ast":null,"code":"var _jsxFileName = \"/Users/owner/Desktop/Team-up-learning_front/src/View/CourseRoomView.js\";\nimport React, { useEffect, useState, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\nconst Container = styled.div`\n  display: flex;\n  width: 100%;\n  height: 100vh;\n  flex-direction: row;\n`;\nconst LeftRow = styled.div`\n  width: 40%;\n  height: 100%;\n`;\nconst RightRow = styled.div`\n  flex: 1;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\nconst Video = styled.video`\n  height: 50%;\n  width: 100%;\n  border: 1px solid black;\n`;\n\nconst Room = props => {\n  const socketRef = useRef();\n  const userVideoRef = useRef();\n  const partnerVideo = useRef();\n  const peerRef = useRef();\n  const VideoPlayer = useRef();\n  const [videoID, setVideoID] = useState(\"\");\n  const [videohost, setVideohost] = useState(\"y\");\n  let tag;\n  let tagp;\n  useEffect(() => {\n    function createPeer(partnerID, callerID, stream) {\n      const peer = new Peer({\n        initiator: true,\n        trickle: false,\n        stream\n      });\n      peer.on(\"signal\", signal => {\n        const payload = {\n          partnerID,\n          callerID,\n          signal\n        };\n        socketRef.current.emit(\"call partner\", payload);\n      });\n      peer.on(\"stream\", handleStream);\n      peer.on(\"data\", handleData);\n      return peer;\n    }\n\n    function addPeer(incomingSignal, callerID, stream) {\n      const peer = new Peer({\n        initiator: false,\n        trickle: false,\n        stream\n      });\n      peer.on(\"signal\", signal => {\n        const payload = {\n          callerID,\n          signal\n        };\n        socketRef.current.emit(\"accept call\", payload);\n      });\n      peer.on(\"stream\", handleStream);\n      peer.on(\"data\", handleData);\n      peer.signal(incomingSignal);\n      return peer;\n    }\n\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      userVideoRef.current.srcObject = stream;\n      socketRef.current = io.connect(\"/\");\n      socketRef.current.emit(\"join room\", props.match.params.roomID);\n      socketRef.current.on(\"other user\", partnerID => {\n        if (partnerID) {\n          peerRef.current = createPeer(partnerID, socketRef.current.id, stream);\n        }\n      });\n      socketRef.current.on(\"caller signal\", incoming => {\n        peerRef.current = addPeer(incoming.signal, incoming.callerID, stream);\n      });\n      socketRef.current.on(\"callee signal\", signal => {\n        peerRef.current.signal(signal);\n      });\n      socketRef.current.on(\"room full\", () => {\n        alert(\"room is full\");\n      });\n    });\n  }, [props.match.params.roomID]);\n  useEffect(() => {\n    tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\"; //tag.src = \"https://www.youtube.com/iframe_api\";\n\n    var firstScriptTag = document.getElementsByTagName(\"script\")[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onYouTubeIframeAPIReady = loadVideoPlayer;\n  }, []);\n\n  function handlePanopto() {\n    setVideohost(\"n\");\n    var lastScriptTag = document.getElementsByTagName(\"script\")[0];\n    lastScriptTag.remove();\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    var tagp = document.createElement(\"script\");\n    tagp.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    firstScriptTag.parentNode.insertBefore(tagp, firstScriptTag);\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }\n\n  function handleYoutube() {\n    setVideohost(\"n\");\n    var lastScriptTag = document.getElementsByTagName(\"script\")[0];\n    document.removeChild(tagp);\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n  }\n\n  function onPanoptoEmbedApiReady() {\n    const player = new window.EmbedApi(\"player\", {\n      width: \"390\",\n      height: \"640\",\n      //This is the URL of your Panopto site\n      serverName: \"uncch.hosted.panopto.com\",\n      sessionId: \"ce9e1932-f77f-4bf9-8268-ad0f013d5c79\",\n      videoParams: {\n        // Optional parameters\n        //interactivity parameter controls if the user sees table of contents, discussions, notes, & in-video search\n        \"interactivity\": \"none\",\n        \"showtitle\": \"false\"\n      },\n      events: {\n        \"onIframeReady\": onPanoptoIframeReady,\n        \"onReady\": onPanoptoVideoReady,\n        \"onStateChange\": onPanoptoStateUpdate\n      }\n    });\n    VideoPlayer.current = player;\n  }\n\n  function onPanoptoIframeReady() {\n    VideoPlayer.current.loadVideo();\n  } //The API will call this function when the video player is ready\n\n\n  function onPanoptoVideoReady() {\n    VideoPlayer.current.seekTo(100);\n  } //The API calls this function when a player state change happens\n\n\n  function onPanoptoStateUpdate(state) {\n    VideoPlayer.current.setVolume(0.3);\n    VideoPlayer.current.setPlaybackRate(2);\n  }\n\n  function loadVideoPlayer() {\n    const player = new window.YT.Player(\"player\", {\n      height: \"390\",\n      width: \"640\"\n    });\n    VideoPlayer.current = player;\n  }\n\n  function stopVideo() {\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"pause\"\n      }));\n    } catch (err) {}\n\n    VideoPlayer.current.pauseVideo();\n  }\n\n  function playVideo() {\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"play\"\n      }));\n    } catch (err) {}\n\n    VideoPlayer.current.playVideo();\n  }\n\n  function loadVideo() {\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"newVideo\",\n        data: videoID\n      }));\n    } catch (err) {}\n\n    if (videohost == \"y\") {\n      VideoPlayer.current.loadVideoById(videoID.split(\"=\")[1]);\n    } else {\n      VideoPlayer.current.sessionId = videoID;\n      VideoPlayer.loadVideo();\n    }\n  }\n\n  function handleStream(stream) {\n    partnerVideo.current.srcObject = stream;\n  }\n\n  function handleData(data) {\n    const parsed = JSON.parse(data);\n\n    if (parsed.type === \"newVideo\") {\n      VideoPlayer.current.loadVideoById(parsed.data.split(\"=\")[1]);\n    } else if (parsed.type === \"pause\") {\n      VideoPlayer.current.pauseVideo();\n    } else {\n      VideoPlayer.current.playVideo();\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(LeftRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Video, {\n    muted: true,\n    autoPlay: true,\n    ref: userVideoRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Video, {\n    muted: true,\n    autoPlay: true,\n    ref: partnerVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(RightRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    id: \"host\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: handlePanopto,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 9\n    }\n  }, \"Panopto\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: handleYoutube,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 9\n    }\n  }, \"Youtube\")), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"player\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: stopVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 9\n    }\n  }, \"Stop Video\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: playVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 9\n    }\n  }, \"Play Video\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"video link\",\n    value: videoID,\n    onChange: e => setVideoID(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: loadVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 9\n    }\n  }, \"Load video\")));\n};\n\nexport default Room;","map":{"version":3,"sources":["/Users/owner/Desktop/Team-up-learning_front/src/View/CourseRoomView.js"],"names":["React","useEffect","useState","useRef","io","Peer","styled","Container","div","LeftRow","RightRow","Video","video","Room","props","socketRef","userVideoRef","partnerVideo","peerRef","VideoPlayer","videoID","setVideoID","videohost","setVideohost","tag","tagp","createPeer","partnerID","callerID","stream","peer","initiator","trickle","on","signal","payload","current","emit","handleStream","handleData","addPeer","incomingSignal","navigator","mediaDevices","getUserMedia","audio","then","srcObject","connect","match","params","roomID","id","incoming","alert","document","createElement","src","firstScriptTag","getElementsByTagName","parentNode","insertBefore","window","onYouTubeIframeAPIReady","loadVideoPlayer","handlePanopto","lastScriptTag","remove","onPanoptoEmbedApiReady","handleYoutube","removeChild","player","EmbedApi","width","height","serverName","sessionId","videoParams","events","onPanoptoIframeReady","onPanoptoVideoReady","onPanoptoStateUpdate","loadVideo","seekTo","state","setVolume","setPlaybackRate","YT","Player","stopVideo","send","JSON","stringify","type","err","pauseVideo","playVideo","data","loadVideoById","split","parsed","parse","e","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\n\nconst Container = styled.div`\n  display: flex;\n  width: 100%;\n  height: 100vh;\n  flex-direction: row;\n`;\n\nconst LeftRow = styled.div`\n  width: 40%;\n  height: 100%;\n`;\n\nconst RightRow = styled.div`\n  flex: 1;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nconst Video = styled.video`\n  height: 50%;\n  width: 100%;\n  border: 1px solid black;\n`;\n\nconst Room = (props) => {\n  const socketRef = useRef();\n  const userVideoRef = useRef();\n  const partnerVideo = useRef();\n  const peerRef = useRef();\n  const VideoPlayer = useRef();\n  const [videoID, setVideoID] = useState(\"\");\n  const [videohost, setVideohost] = useState(\"y\");\n  let tag;\n  let tagp;\n\n  useEffect(() => {\n    function createPeer(partnerID, callerID, stream) {\n      const peer = new Peer({\n        initiator: true,\n        trickle: false,\n        stream\n      });\n\n      peer.on(\"signal\", (signal) => {\n        const payload = {\n          partnerID,\n          callerID,\n          signal\n        };\n        socketRef.current.emit(\"call partner\", payload);\n      });\n\n      peer.on(\"stream\", handleStream);\n      peer.on(\"data\", handleData);\n\n      return peer;\n    }\n\n    function addPeer(incomingSignal, callerID, stream) {\n      const peer = new Peer({\n        initiator: false,\n        trickle: false,\n        stream\n      });\n\n      peer.on(\"signal\", (signal) => {\n        const payload = {\n          callerID,\n          signal\n        };\n        socketRef.current.emit(\"accept call\", payload);\n      });\n\n      peer.on(\"stream\", handleStream);\n      peer.on(\"data\", handleData);\n\n      peer.signal(incomingSignal);\n      return peer;\n    }\n\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        userVideoRef.current.srcObject = stream;\n        socketRef.current = io.connect(\"/\");\n        socketRef.current.emit(\"join room\", props.match.params.roomID);\n\n        socketRef.current.on(\"other user\", (partnerID) => {\n          if (partnerID) {\n            peerRef.current = createPeer(\n              partnerID,\n              socketRef.current.id,\n              stream\n            );\n          }\n        });\n\n        socketRef.current.on(\"caller signal\", (incoming) => {\n          peerRef.current = addPeer(incoming.signal, incoming.callerID, stream);\n        });\n\n        socketRef.current.on(\"callee signal\", (signal) => {\n          peerRef.current.signal(signal);\n        });\n\n        socketRef.current.on(\"room full\", () => {\n          alert(\"room is full\");\n        });\n      });\n  }, [props.match.params.roomID]);\n\n  useEffect(() => {\n    tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    //tag.src = \"https://www.youtube.com/iframe_api\";\n    var firstScriptTag = document.getElementsByTagName(\"script\")[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onYouTubeIframeAPIReady = loadVideoPlayer;\n  }, []);\n\n\n  function handlePanopto() {\n    setVideohost(\"n\");\n    var lastScriptTag = document.getElementsByTagName(\"script\")[0];\n    lastScriptTag.remove();\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    var tagp = document.createElement(\"script\");\n    tagp.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    firstScriptTag.parentNode.insertBefore(tagp, firstScriptTag);\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }\n\n  function handleYoutube() {\n    setVideohost(\"n\");\n    var lastScriptTag = document.getElementsByTagName(\"script\")[0];\n    document.removeChild(tagp);\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n  }\n\n  function onPanoptoEmbedApiReady(){\n            const player = new window.EmbedApi(\"player\", {\n                width: \"390\",\n                height: \"640\",\n                //This is the URL of your Panopto site\n                serverName: \"uncch.hosted.panopto.com\",\n                sessionId: \"ce9e1932-f77f-4bf9-8268-ad0f013d5c79\",\n                videoParams: { // Optional parameters\n                //interactivity parameter controls if the user sees table of contents, discussions, notes, & in-video search\n                    \"interactivity\": \"none\",\n                    \"showtitle\": \"false\"\n                },\n                events: {\n                    \"onIframeReady\": onPanoptoIframeReady,\n                    \"onReady\": onPanoptoVideoReady,\n                    \"onStateChange\": onPanoptoStateUpdate\n                }\n            });\n            VideoPlayer.current = player;\n  }\n\n  function onPanoptoIframeReady()\n  {\n    VideoPlayer.current.loadVideo();\n  }\n\n    //The API will call this function when the video player is ready\n  function onPanoptoVideoReady()\n  {\n      VideoPlayer.current.seekTo(100);\n  }\n\n  //The API calls this function when a player state change happens\n   function onPanoptoStateUpdate(state)\n  {\n          VideoPlayer.current.setVolume(0.3);\n          VideoPlayer.current.setPlaybackRate(2);\n  }\n\n  function loadVideoPlayer() {\n    const player = new window.YT.Player(\"player\", {\n      height: \"390\",\n      width: \"640\"\n    });\n\n    VideoPlayer.current = player;\n  }\n\n  function stopVideo() {\n    try {\n          peerRef.current.send(JSON.stringify({ type: \"pause\" }));\n      }\n      catch(err) {\n      }\n    VideoPlayer.current.pauseVideo();\n  }\n\n  function playVideo() {\n    try {\n        peerRef.current.send(JSON.stringify({ type: \"play\" }));\n      }\n      catch(err) {\n      }\n    VideoPlayer.current.playVideo();\n  }\n\n  function loadVideo() {\n    try {\n        peerRef.current.send(JSON.stringify({ type: \"newVideo\", data: videoID }));\n      }\n      catch(err) {\n      }\n    if(videohost==\"y\"){\n      VideoPlayer.current.loadVideoById(videoID.split(\"=\")[1]);\n    } else {\n      VideoPlayer.current.sessionId=videoID;\n      VideoPlayer.loadVideo();\n    }\n  }\n\n\n  function handleStream(stream) {\n    partnerVideo.current.srcObject = stream;\n  }\n\n  function handleData(data) {\n    const parsed = JSON.parse(data);\n    if (parsed.type === \"newVideo\") {\n      VideoPlayer.current.loadVideoById(parsed.data.split(\"=\")[1]);\n    } else if (parsed.type === \"pause\") {\n      VideoPlayer.current.pauseVideo();\n    } else {\n      VideoPlayer.current.playVideo();\n    }\n  }\n\n  return (\n    <Container>\n      <LeftRow>\n        <Video muted autoPlay ref={userVideoRef} />\n        <Video muted autoPlay ref={partnerVideo} />\n      </LeftRow>\n      <RightRow>\n        <div id = \"host\">\n        <button onClick={handlePanopto}>Panopto</button>\n        <button onClick={handleYoutube}>Youtube</button>\n        </div>\n        <div id=\"player\" />\n        <button onClick={stopVideo}>Stop Video</button>\n        <button onClick={playVideo}>Play Video</button>\n        <input\n          type=\"text\"\n          placeholder=\"video link\"\n          value={videoID}\n          onChange={(e) => setVideoID(e.target.value)}\n        />\n        <button onClick={loadVideo}>Load video</button>\n      </RightRow>\n    </Container>\n  );\n};\n\nexport default Room;\n"]},"metadata":{},"sourceType":"module"}