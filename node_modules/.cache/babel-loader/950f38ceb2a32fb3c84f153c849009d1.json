{"ast":null,"code":"var _jsxFileName = \"/Users/owner/Desktop/teamapp/src/View/CourseRoomView.js\";\nimport React, { useEffect, useState, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\nimport { YOUR_API_KEY } from '../Utils/Authentication.js';\nimport axios from \"axios\";\nconst Container = styled.div`\n  display: flex;\n  width: 100%;\n  height: 100vh;\n  flex-direction: row;\n`;\nconst LeftRow = styled.div`\n  width: 40%;\n  height: 100%;\n`;\nconst RightRow = styled.div`\n  flex: 1;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\nconst Video = styled.video`\n  height: 50%;\n  width: 100%;\n  border: 1px solid black;\n`;\n\nconst Room = props => {\n  const socketRef = useRef();\n  const userVideoRef = useRef();\n  const partnerVideo = useRef();\n  const peerRef = useRef();\n  const VideoPlayer = useRef(); //const [inputvalue, setInputvalue] = useState(\"\");\n\n  const [videoID, setVideoID] = useState(\"\");\n  const [videohost, setVideohost] = useState(\"\");\n\n  function createPeer(partnerID, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream\n    });\n    peer.on(\"signal\", signal => {\n      const payload = {\n        partnerID,\n        callerID,\n        signal\n      };\n      socketRef.current.emit(\"call partner\", payload);\n    });\n    peer.on(\"stream\", handleStream);\n    peer.on(\"data\", handleData);\n    return peer;\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream\n    });\n    peer.on(\"signal\", signal => {\n      const payload = {\n        callerID,\n        signal\n      };\n      socketRef.current.emit(\"accept call\", payload);\n    });\n    peer.on(\"stream\", handleStream);\n    peer.on(\"data\", handleData);\n    peer.signal(incomingSignal);\n    return peer;\n  }\n\n  useEffect(() => {\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      userVideoRef.current.srcObject = stream;\n      socketRef.current = io.connect('https://backendteamlearning.herokuapp.com/', {\n        'sync disconnect on unload': true,\n        withCredentials: false\n      }); //http://ec2-3-17-9-85.us-east-2.compute.amazonaws.com:5000/\n\n      socketRef.current.emit(\"join room\", props.match.params.roomID);\n      socketRef.current.on(\"other user\", partnerID => {\n        if (partnerID) {\n          peerRef.current = createPeer(partnerID, socketRef.current.id, stream);\n        }\n      });\n      socketRef.current.on(\"caller signal\", incoming => {\n        peerRef.current = addPeer(incoming.signal, incoming.callerID, stream);\n      });\n      socketRef.current.on(\"callee signal\", signal => {\n        peerRef.current.signal(signal);\n      });\n      socketRef.current.on(\"room full\", () => {\n        alert(\"room is full\");\n      });\n    });\n  }, [props.match.params.roomID]);\n\n  function handlePanopto() {\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }\n\n  function handleYoutube() {\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://www.youtube.com/iframe_api\";\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onYouTubeIframeAPIReady = loadVideoPlayer;\n  }\n\n  function onPanoptoEmbedApiReady() {\n    const player = new window.EmbedApi(\"player\", {\n      width: \"640\",\n      height: \"390\",\n      //This is the URL of your Panopto site\n      serverName: \"uncch.hosted.panopto.com\",\n      sessionId: videoID,\n      videoParams: {\n        // Optional parameters\n        //interactivity parameter controls if the user sees table of contents, discussions, notes, & in-video search\n        \"interactivity\": \"none\",\n        \"showtitle\": \"false\"\n      },\n      events: {\n        \"onIframeReady\": onPanoptoIframeReady,\n        \"onReady\": onPanoptoVideoReady,\n        \"onStateChange\": onPanoptoStateUpdate\n      }\n    });\n    VideoPlayer.current = player;\n  }\n\n  function onPanoptoIframeReady() {\n    VideoPlayer.current.loadVideo();\n  } //The API will call this function when the video player is ready\n\n\n  function onPanoptoVideoReady() {\n    VideoPlayer.current.seekTo(100);\n  } //The API calls this function when a player state change happens\n\n\n  function onPanoptoStateUpdate(state) {\n    VideoPlayer.current.setVolume(0.3);\n    VideoPlayer.current.setPlaybackRate(2);\n  }\n\n  function loadVideoPlayer() {\n    const player = new window.YT.Player(\"player\", {\n      height: \"390\",\n      width: \"640\",\n      videoId: videoID\n    });\n    VideoPlayer.current = player;\n  }\n\n  function stopVideo() {\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"pause\"\n      }));\n    } catch (err) {}\n\n    VideoPlayer.current.pauseVideo();\n  }\n\n  function playVideo() {\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"play\"\n      }));\n    } catch (err) {}\n\n    VideoPlayer.current.playVideo();\n  }\n\n  function handleVideo() {\n    document.getElementsByTagName('input')[0].remove();\n    document.getElementById('loadVideo').remove();\n\n    if (videohost == \"y\") {\n      handleYoutube();\n    } else {\n      handlePanopto();\n    }\n\n    var play = document.createElement(\"button\");\n    play.innerHTML = \"Play Video\";\n    play.addEventListener(\"click\", playVideo);\n    var stop = document.createElement(\"button\");\n    stop.innerHTML = \"Stop Video\";\n    stop.addEventListener(\"click\", stopVideo);\n    var div = document.getElementById(\"controls\");\n    div.appendChild(play);\n    div.appendChild(stop);\n    axios.get(`https://youtube.googleapis.com/youtube/v3/videos?part=snippet%2CcontentDetails%2Cstatistics&id=${videoID}&key=${YOUR_API_KEY}`).then(response => {\n      console.log(response.data);\n      let title = response.data.items[0].snippet.title;\n      let description = response.data.items[0].snippet.description;\n      document.getElementById(\"videoTitle\").innerHTML = title;\n      document.getElementById(\"videoDescription\").innerHTML = description;\n    }).catch(err => console.log(err));\n  }\n\n  function loadVideo() {\n    if (videohost == '') {\n      alert(\"please select video player first\");\n      return;\n    }\n\n    if (videoID == '') {\n      alert(\"please upload video id\");\n      return;\n    }\n\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"newVideo\",\n        host: videohost,\n        data: videoID\n      }));\n    } catch (err) {}\n\n    handleVideo();\n  }\n\n  useEffect(() => {\n    if (videohost == 'y') {\n      document.getElementById('YT').style.backgroundColor = \"#666666\";\n      document.getElementById('PT').style.backgroundColor = \"#668cff\";\n    } else if (videohost == 'n') {\n      document.getElementById('YT').style.backgroundColor = \"#668cff\";\n      document.getElementById('PT').style.backgroundColor = \"#666666\";\n    }\n  }, [videohost]);\n\n  function ClickYoutube(e) {\n    setVideohost(\"y\");\n  }\n\n  function ClickPT(e) {\n    setVideohost(\"n\");\n  }\n\n  function handleStream(stream) {\n    partnerVideo.current.srcObject = stream;\n  }\n\n  function handleData(data) {\n    const parsed = JSON.parse(data);\n\n    if (parsed.type === \"newVideo\") {\n      setVideohost(parsed.host);\n      setVideoID(parsed.data);\n    } else if (parsed.type === \"pause\") {\n      VideoPlayer.current.pauseVideo();\n    } else {\n      VideoPlayer.current.playVideo();\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(LeftRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Video, {\n    muted: true,\n    autoPlay: true,\n    ref: userVideoRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Video, {\n    muted: true,\n    autoPlay: true,\n    ref: partnerVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(RightRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    id: \"host\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    id: \"PT\",\n    backgroundColor: \"#668cff\",\n    onClick: ClickPT,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 9\n    }\n  }, \"Panopto\"), /*#__PURE__*/React.createElement(\"button\", {\n    id: \"YT\",\n    backgroundColor: \"#668cff\",\n    onClick: ClickYoutube,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 9\n    }\n  }, \"Youtube\")), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"player\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"controls\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"video link\",\n    value: videoID,\n    onChange: e => setVideoID(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    id: \"loadVideo\",\n    onClick: loadVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 303,\n      columnNumber: 9\n    }\n  }, \"Load video\")), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    id: \"videoTitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    id: \"videoDescription\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 9\n    }\n  }))));\n};\n\nexport default Room;","map":{"version":3,"sources":["/Users/owner/Desktop/teamapp/src/View/CourseRoomView.js"],"names":["React","useEffect","useState","useRef","io","Peer","styled","YOUR_API_KEY","axios","Container","div","LeftRow","RightRow","Video","video","Room","props","socketRef","userVideoRef","partnerVideo","peerRef","VideoPlayer","videoID","setVideoID","videohost","setVideohost","createPeer","partnerID","callerID","stream","peer","initiator","trickle","on","signal","payload","current","emit","handleStream","handleData","addPeer","incomingSignal","navigator","mediaDevices","getUserMedia","audio","then","srcObject","connect","withCredentials","match","params","roomID","id","incoming","alert","handlePanopto","firstScriptTag","document","getElementsByTagName","tag","createElement","src","parentNode","insertBefore","window","onPanoptoEmbedApiReady","handleYoutube","onYouTubeIframeAPIReady","loadVideoPlayer","player","EmbedApi","width","height","serverName","sessionId","videoParams","events","onPanoptoIframeReady","onPanoptoVideoReady","onPanoptoStateUpdate","loadVideo","seekTo","state","setVolume","setPlaybackRate","YT","Player","videoId","stopVideo","send","JSON","stringify","type","err","pauseVideo","playVideo","handleVideo","remove","getElementById","play","innerHTML","addEventListener","stop","appendChild","get","response","console","log","data","title","items","snippet","description","catch","host","style","backgroundColor","ClickYoutube","e","ClickPT","parsed","parse","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\nimport {YOUR_API_KEY} from '../Utils/Authentication.js';\nimport axios from \"axios\";\n\nconst Container = styled.div`\n  display: flex;\n  width: 100%;\n  height: 100vh;\n  flex-direction: row;\n`;\n\nconst LeftRow = styled.div`\n  width: 40%;\n  height: 100%;\n`;\n\nconst RightRow = styled.div`\n  flex: 1;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nconst Video = styled.video`\n  height: 50%;\n  width: 100%;\n  border: 1px solid black;\n`;\n\nconst Room = (props) => {\n  const socketRef = useRef();\n  const userVideoRef = useRef();\n  const partnerVideo = useRef();\n  const peerRef = useRef();\n  const VideoPlayer = useRef();\n  //const [inputvalue, setInputvalue] = useState(\"\");\n  const [videoID, setVideoID] = useState(\"\");\n  const [videohost, setVideohost] = useState(\"\");\n\n  function createPeer(partnerID, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream\n    });\n\n    peer.on(\"signal\", (signal) => {\n      const payload = {\n        partnerID,\n        callerID,\n        signal\n      };\n      socketRef.current.emit(\"call partner\", payload);\n    });\n\n    peer.on(\"stream\", handleStream);\n    peer.on(\"data\", handleData);\n\n    return peer;\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream\n    });\n\n    peer.on(\"signal\", (signal) => {\n      const payload = {\n        callerID,\n        signal\n      };\n      socketRef.current.emit(\"accept call\", payload);\n    });\n\n    peer.on(\"stream\", handleStream);\n    peer.on(\"data\", handleData);\n\n    peer.signal(incomingSignal);\n    return peer;\n  }\n\n  useEffect(() => {\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        userVideoRef.current.srcObject = stream;\n        socketRef.current = io.connect('https://backendteamlearning.herokuapp.com/',{\n  'sync disconnect on unload':true,\n   withCredentials: false\n});\n        //http://ec2-3-17-9-85.us-east-2.compute.amazonaws.com:5000/\n        socketRef.current.emit(\"join room\", props.match.params.roomID);\n\n        socketRef.current.on(\"other user\", (partnerID) => {\n          if (partnerID) {\n            peerRef.current = createPeer(\n              partnerID,\n              socketRef.current.id,\n              stream\n            );\n          }\n        });\n\n        socketRef.current.on(\"caller signal\", (incoming) => {\n          peerRef.current = addPeer(incoming.signal, incoming.callerID, stream);\n        });\n\n        socketRef.current.on(\"callee signal\", (signal) => {\n          peerRef.current.signal(signal);\n        });\n\n        socketRef.current.on(\"room full\", () => {\n          alert(\"room is full\");\n        });\n      });\n  }, [props.match.params.roomID]);\n\n\n  function handlePanopto() {\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }\n\n  function handleYoutube() {\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://www.youtube.com/iframe_api\";\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onYouTubeIframeAPIReady = loadVideoPlayer;\n  }\n\n  function onPanoptoEmbedApiReady(){\n            const player = new window.EmbedApi(\"player\", {\n                width: \"640\",\n                height: \"390\",\n                //This is the URL of your Panopto site\n                serverName: \"uncch.hosted.panopto.com\",\n                sessionId: videoID,\n                videoParams: { // Optional parameters\n                //interactivity parameter controls if the user sees table of contents, discussions, notes, & in-video search\n                    \"interactivity\": \"none\",\n                    \"showtitle\": \"false\"\n                },\n                events: {\n                    \"onIframeReady\": onPanoptoIframeReady,\n                    \"onReady\": onPanoptoVideoReady,\n                    \"onStateChange\": onPanoptoStateUpdate\n                }\n            });\n            VideoPlayer.current = player;\n  }\n\n  function onPanoptoIframeReady()\n  {\n    VideoPlayer.current.loadVideo();\n  }\n\n    //The API will call this function when the video player is ready\n  function onPanoptoVideoReady()\n  {\n      VideoPlayer.current.seekTo(100);\n  }\n\n  //The API calls this function when a player state change happens\n   function onPanoptoStateUpdate(state)\n  {\n          VideoPlayer.current.setVolume(0.3);\n          VideoPlayer.current.setPlaybackRate(2);\n  }\n\n  function loadVideoPlayer() {\n    const player = new window.YT.Player(\"player\", {\n      height: \"390\",\n      width: \"640\",\n      videoId: videoID\n    });\n\n    VideoPlayer.current = player;\n  }\n\n  function stopVideo() {\n    try {\n          peerRef.current.send(JSON.stringify({ type: \"pause\" }));\n      }\n      catch(err) {\n      }\n    VideoPlayer.current.pauseVideo();\n  }\n\n  function playVideo() {\n    try {\n        peerRef.current.send(JSON.stringify({ type: \"play\" }));\n      }\n      catch(err) {\n      }\n    VideoPlayer.current.playVideo();\n  }\n\n  function handleVideo(){\n    document.getElementsByTagName('input')[0].remove();\n    document.getElementById('loadVideo').remove();\n    if(videohost==\"y\"){\n      handleYoutube();\n    } else {\n      handlePanopto();\n    }\n    var play= document.createElement(\"button\");\n    play.innerHTML = \"Play Video\";\n    play.addEventListener (\"click\", playVideo);\n    var stop= document.createElement(\"button\");\n    stop.innerHTML = \"Stop Video\";\n    stop.addEventListener (\"click\", stopVideo);\n    var div = document.getElementById(\"controls\");\n    div.appendChild(play);\n    div.appendChild(stop);\n    axios.get(`https://youtube.googleapis.com/youtube/v3/videos?part=snippet%2CcontentDetails%2Cstatistics&id=${videoID}&key=${YOUR_API_KEY}`)\n      .then((response)=>{\n        console.log(response.data);\n        let title = response.data.items[0].snippet.title;\n        let description=response.data.items[0].snippet.description;\n        document.getElementById(\"videoTitle\").innerHTML=title;\n        document.getElementById(\"videoDescription\").innerHTML=description;\n      }).catch(err=>console.log(err));\n  }\n\n  function loadVideo() {\n    if(videohost==''){\n      alert(\"please select video player first\");\n      return;\n    }\n    if(videoID==''){\n      alert(\"please upload video id\");\n      return;\n    }\n    try {\n        peerRef.current.send(JSON.stringify({ type: \"newVideo\",host:videohost, data: videoID }));\n      }\n      catch(err) {\n    }\n    handleVideo();\n  }\n\n  useEffect(() => {\n    if(videohost=='y'){\n      document.getElementById('YT').style.backgroundColor=\"#666666\";\n      document.getElementById('PT').style.backgroundColor=\"#668cff\";\n    }else if(videohost=='n'){\n      document.getElementById('YT').style.backgroundColor=\"#668cff\";\n      document.getElementById('PT').style.backgroundColor=\"#666666\";\n    }\n  },[videohost])\n\n\n  function ClickYoutube(e){\n    setVideohost(\"y\");\n  }\n\n  function ClickPT(e){\n    setVideohost(\"n\");\n  }\n\n\n  function handleStream(stream) {\n    partnerVideo.current.srcObject = stream;\n  }\n\n\n  function handleData(data) {\n    const parsed = JSON.parse(data);\n    if (parsed.type === \"newVideo\") {\n      setVideohost(parsed.host);\n      setVideoID(parsed.data);\n    } else if (parsed.type === \"pause\") {\n      VideoPlayer.current.pauseVideo();\n    } else {\n      VideoPlayer.current.playVideo();\n    }\n  }\n\n  return (\n    <Container>\n      <LeftRow>\n        <Video muted autoPlay ref={userVideoRef} />\n        <Video muted autoPlay ref={partnerVideo} />\n      </LeftRow>\n      <RightRow>\n        <div id = \"host\">\n        <button id=\"PT\" backgroundColor=\"#668cff\" onClick={ClickPT}>Panopto</button>\n        <button id=\"YT\" backgroundColor=\"#668cff\" onClick={ClickYoutube}>Youtube</button>\n        </div>\n        <div id=\"player\" />\n        <div id=\"controls\">\n        <input type=\"text\" placeholder=\"video link\" value={videoID} onChange={e => setVideoID(e.target.value)} />\n        <button id =\"loadVideo\" onClick={loadVideo}>Load video</button>\n        </div>\n        <div>\n        <h3 id=\"videoTitle\"></h3>\n        <br/>\n        <p id=\"videoDescription\"></p>\n        </div>\n\n      </RightRow>\n    </Container>\n  );\n};\n\nexport default Room;\n"]},"metadata":{},"sourceType":"module"}