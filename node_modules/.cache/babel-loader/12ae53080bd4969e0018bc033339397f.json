{"ast":null,"code":"var _jsxFileName = \"/Users/owner/Desktop/Team-up-learning_front/src/View/CourseRoomView.js\";\nimport React, { useEffect, useState, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\nconst Container = styled.div`\n  display: flex;\n  width: 100%;\n  height: 100vh;\n  flex-direction: row;\n`;\nconst LeftRow = styled.div`\n  width: 40%;\n  height: 100%;\n`;\nconst RightRow = styled.div`\n  flex: 1;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\nconst Video = styled.video`\n  height: 50%;\n  width: 100%;\n  border: 1px solid black;\n`;\n\nconst Room = props => {\n  const socketRef = useRef();\n  const userVideoRef = useRef();\n  const partnerVideo = useRef();\n  const peerRef = useRef();\n  const VideoPlayer = useRef();\n  const [videoID, setVideoID] = useState(\"\");\n  const [videohost, setVideohost] = useState(\"n\");\n  let tag;\n  let tagp;\n  useEffect(() => {\n    function createPeer(partnerID, callerID, stream) {\n      const peer = new Peer({\n        initiator: true,\n        trickle: false,\n        stream\n      });\n      peer.on(\"signal\", signal => {\n        const payload = {\n          partnerID,\n          callerID,\n          signal\n        };\n        socketRef.current.emit(\"call partner\", payload);\n      });\n      peer.on(\"stream\", handleStream);\n      peer.on(\"data\", handleData);\n      return peer;\n    }\n\n    function addPeer(incomingSignal, callerID, stream) {\n      const peer = new Peer({\n        initiator: false,\n        trickle: false,\n        stream\n      });\n      peer.on(\"signal\", signal => {\n        const payload = {\n          callerID,\n          signal\n        };\n        socketRef.current.emit(\"accept call\", payload);\n      });\n      peer.on(\"stream\", handleStream);\n      peer.on(\"data\", handleData);\n      peer.signal(incomingSignal);\n      return peer;\n    }\n\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      userVideoRef.current.srcObject = stream;\n      socketRef.current = io.connect(\"/\");\n      socketRef.current.emit(\"join room\", props.match.params.roomID);\n      socketRef.current.on(\"other user\", partnerID => {\n        if (partnerID) {\n          peerRef.current = createPeer(partnerID, socketRef.current.id, stream);\n        }\n      });\n      socketRef.current.on(\"caller signal\", incoming => {\n        peerRef.current = addPeer(incoming.signal, incoming.callerID, stream);\n      });\n      socketRef.current.on(\"callee signal\", signal => {\n        peerRef.current.signal(signal);\n      });\n      socketRef.current.on(\"room full\", () => {\n        alert(\"room is full\");\n      });\n    });\n  }, [props.match.params.roomID]);\n  /*useEffect(() => {\n    tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    //tag.src = \"https://www.youtube.com/iframe_api\";\n    var firstScriptTag = document.getElementsByTagName(\"script\")[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    //window.onYouTubeIframeAPIReady = loadVideoPlayer;\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }, []);*/\n\n  function handlePanopto() {\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }\n\n  function handleYoutube() {\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://www.youtube.com/iframe_api\";\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onYouTubeIframeAPIReady = loadVideoPlayer;\n  }\n\n  function onPanoptoEmbedApiReady() {\n    const player = new window.EmbedApi(\"player\", {\n      width: \"640\",\n      height: \"390\",\n      //This is the URL of your Panopto site\n      serverName: \"uncch.hosted.panopto.com\",\n      sessionId: videoID,\n      videoParams: {\n        // Optional parameters\n        //interactivity parameter controls if the user sees table of contents, discussions, notes, & in-video search\n        \"interactivity\": \"none\",\n        \"showtitle\": \"false\"\n      },\n      events: {\n        \"onIframeReady\": onPanoptoIframeReady,\n        \"onReady\": onPanoptoVideoReady,\n        \"onStateChange\": onPanoptoStateUpdate\n      }\n    });\n    VideoPlayer.current = player;\n  }\n\n  function onPanoptoIframeReady() {\n    VideoPlayer.current.loadVideo();\n  } //The API will call this function when the video player is ready\n\n\n  function onPanoptoVideoReady() {\n    VideoPlayer.current.seekTo(100);\n  } //The API calls this function when a player state change happens\n\n\n  function onPanoptoStateUpdate(state) {\n    VideoPlayer.current.setVolume(0.3);\n    VideoPlayer.current.setPlaybackRate(2);\n  }\n\n  function loadVideoPlayer() {\n    const player = new window.YT.Player(\"player\", {\n      height: \"390\",\n      width: \"640\"\n    });\n    VideoPlayer.current = player;\n  }\n\n  function stopVideo() {\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"pause\"\n      }));\n    } catch (err) {}\n\n    VideoPlayer.current.pauseVideo();\n  }\n\n  function playVideo() {\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"play\"\n      }));\n    } catch (err) {}\n\n    VideoPlayer.current.playVideo();\n  }\n\n  function loadVideo() {\n    try {\n      peerRef.current.send(JSON.stringify({\n        type: \"newVideo\",\n        host: videohost,\n        data: videoID\n      }));\n    } catch (err) {}\n\n    document.getElementsByTagName('input')[0].remove();\n    document.getElementById('loadVideo').remove();\n\n    if (videohost == \"y\") {\n      handleYoutube();\n      VideoPlayer.current.loadVideoById(videoID.split(\"=\")[1]);\n    } else {\n      handlePanopto();\n    }\n  }\n\n  function handleStream(stream) {\n    partnerVideo.current.srcObject = stream;\n  }\n\n  function handleData(data) {\n    const parsed = JSON.parse(data);\n\n    if (parsed.type === \"newVideo\") {\n      VideoPlayer.current.loadVideoById(parsed.data.split(\"=\")[1]);\n    } else if (parsed.type === \"pause\") {\n      VideoPlayer.current.pauseVideo();\n    } else {\n      VideoPlayer.current.playVideo();\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(LeftRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Video, {\n    muted: true,\n    autoPlay: true,\n    ref: userVideoRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Video, {\n    muted: true,\n    autoPlay: true,\n    ref: partnerVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(RightRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    id: \"host\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: e => setVideohost(\"n\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 9\n    }\n  }, \"Panopto\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: e => setVideohost(\"y\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 9\n    }\n  }, \"Youtube\")), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"player\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"controls\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"video link\",\n    value: videoID,\n    onChange: e => setVideoID(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    id: \"loadVideo\",\n    onClick: loadVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 9\n    }\n  }, \"Load video\"))));\n};\n\nexport default Room;","map":{"version":3,"sources":["/Users/owner/Desktop/Team-up-learning_front/src/View/CourseRoomView.js"],"names":["React","useEffect","useState","useRef","io","Peer","styled","Container","div","LeftRow","RightRow","Video","video","Room","props","socketRef","userVideoRef","partnerVideo","peerRef","VideoPlayer","videoID","setVideoID","videohost","setVideohost","tag","tagp","createPeer","partnerID","callerID","stream","peer","initiator","trickle","on","signal","payload","current","emit","handleStream","handleData","addPeer","incomingSignal","navigator","mediaDevices","getUserMedia","audio","then","srcObject","connect","match","params","roomID","id","incoming","alert","handlePanopto","firstScriptTag","document","getElementsByTagName","createElement","src","parentNode","insertBefore","window","onPanoptoEmbedApiReady","handleYoutube","onYouTubeIframeAPIReady","loadVideoPlayer","player","EmbedApi","width","height","serverName","sessionId","videoParams","events","onPanoptoIframeReady","onPanoptoVideoReady","onPanoptoStateUpdate","loadVideo","seekTo","state","setVolume","setPlaybackRate","YT","Player","stopVideo","send","JSON","stringify","type","err","pauseVideo","playVideo","host","data","remove","getElementById","loadVideoById","split","parsed","parse","e","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\n\nconst Container = styled.div`\n  display: flex;\n  width: 100%;\n  height: 100vh;\n  flex-direction: row;\n`;\n\nconst LeftRow = styled.div`\n  width: 40%;\n  height: 100%;\n`;\n\nconst RightRow = styled.div`\n  flex: 1;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nconst Video = styled.video`\n  height: 50%;\n  width: 100%;\n  border: 1px solid black;\n`;\n\nconst Room = (props) => {\n  const socketRef = useRef();\n  const userVideoRef = useRef();\n  const partnerVideo = useRef();\n  const peerRef = useRef();\n  const VideoPlayer = useRef();\n  const [videoID, setVideoID] = useState(\"\");\n  const [videohost, setVideohost] = useState(\"n\");\n  let tag;\n  let tagp;\n\n  useEffect(() => {\n    function createPeer(partnerID, callerID, stream) {\n      const peer = new Peer({\n        initiator: true,\n        trickle: false,\n        stream\n      });\n\n      peer.on(\"signal\", (signal) => {\n        const payload = {\n          partnerID,\n          callerID,\n          signal\n        };\n        socketRef.current.emit(\"call partner\", payload);\n      });\n\n      peer.on(\"stream\", handleStream);\n      peer.on(\"data\", handleData);\n\n      return peer;\n    }\n\n    function addPeer(incomingSignal, callerID, stream) {\n      const peer = new Peer({\n        initiator: false,\n        trickle: false,\n        stream\n      });\n\n      peer.on(\"signal\", (signal) => {\n        const payload = {\n          callerID,\n          signal\n        };\n        socketRef.current.emit(\"accept call\", payload);\n      });\n\n      peer.on(\"stream\", handleStream);\n      peer.on(\"data\", handleData);\n\n      peer.signal(incomingSignal);\n      return peer;\n    }\n\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        userVideoRef.current.srcObject = stream;\n        socketRef.current = io.connect(\"/\");\n        socketRef.current.emit(\"join room\", props.match.params.roomID);\n\n        socketRef.current.on(\"other user\", (partnerID) => {\n          if (partnerID) {\n            peerRef.current = createPeer(\n              partnerID,\n              socketRef.current.id,\n              stream\n            );\n          }\n        });\n\n        socketRef.current.on(\"caller signal\", (incoming) => {\n          peerRef.current = addPeer(incoming.signal, incoming.callerID, stream);\n        });\n\n        socketRef.current.on(\"callee signal\", (signal) => {\n          peerRef.current.signal(signal);\n        });\n\n        socketRef.current.on(\"room full\", () => {\n          alert(\"room is full\");\n        });\n      });\n  }, [props.match.params.roomID]);\n\n  /*useEffect(() => {\n    tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    //tag.src = \"https://www.youtube.com/iframe_api\";\n    var firstScriptTag = document.getElementsByTagName(\"script\")[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    //window.onYouTubeIframeAPIReady = loadVideoPlayer;\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }, []);*/\n\n\n  function handlePanopto() {\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://developers.panopto.com/scripts/embedapi.min.js\";\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onPanoptoEmbedApiReady = onPanoptoEmbedApiReady;\n  }\n\n  function handleYoutube() {\n    var tag = document.createElement(\"script\");\n    tag.src = \"https://www.youtube.com/iframe_api\";\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    window.onYouTubeIframeAPIReady = loadVideoPlayer;\n  }\n\n  function onPanoptoEmbedApiReady(){\n            const player = new window.EmbedApi(\"player\", {\n                width: \"640\",\n                height: \"390\",\n                //This is the URL of your Panopto site\n                serverName: \"uncch.hosted.panopto.com\",\n                sessionId: videoID,\n                videoParams: { // Optional parameters\n                //interactivity parameter controls if the user sees table of contents, discussions, notes, & in-video search\n                    \"interactivity\": \"none\",\n                    \"showtitle\": \"false\"\n                },\n                events: {\n                    \"onIframeReady\": onPanoptoIframeReady,\n                    \"onReady\": onPanoptoVideoReady,\n                    \"onStateChange\": onPanoptoStateUpdate\n                }\n            });\n            VideoPlayer.current = player;\n  }\n\n  function onPanoptoIframeReady()\n  {\n    VideoPlayer.current.loadVideo();\n  }\n\n    //The API will call this function when the video player is ready\n  function onPanoptoVideoReady()\n  {\n      VideoPlayer.current.seekTo(100);\n  }\n\n  //The API calls this function when a player state change happens\n   function onPanoptoStateUpdate(state)\n  {\n          VideoPlayer.current.setVolume(0.3);\n          VideoPlayer.current.setPlaybackRate(2);\n  }\n\n  function loadVideoPlayer() {\n    const player = new window.YT.Player(\"player\", {\n      height: \"390\",\n      width: \"640\"\n    });\n\n    VideoPlayer.current = player;\n  }\n\n  function stopVideo() {\n    try {\n          peerRef.current.send(JSON.stringify({ type: \"pause\" }));\n      }\n      catch(err) {\n      }\n    VideoPlayer.current.pauseVideo();\n  }\n\n  function playVideo() {\n    try {\n        peerRef.current.send(JSON.stringify({ type: \"play\" }));\n      }\n      catch(err) {\n      }\n    VideoPlayer.current.playVideo();\n  }\n\n  function loadVideo() {\n    try {\n        peerRef.current.send(JSON.stringify({ type: \"newVideo\",host:videohost, data: videoID }));\n      }\n      catch(err) {\n    }\n    document.getElementsByTagName('input')[0].remove();\n    document.getElementById('loadVideo').remove();\n    if(videohost==\"y\"){\n      handleYoutube();\n      VideoPlayer.current.loadVideoById(videoID.split(\"=\")[1]);\n    } else {\n      handlePanopto();\n    }\n  }\n\n\n  function handleStream(stream) {\n    partnerVideo.current.srcObject = stream;\n  }\n\n  function handleData(data) {\n    const parsed = JSON.parse(data);\n    if (parsed.type === \"newVideo\") {\n      VideoPlayer.current.loadVideoById(parsed.data.split(\"=\")[1]);\n    } else if (parsed.type === \"pause\") {\n      VideoPlayer.current.pauseVideo();\n    } else {\n      VideoPlayer.current.playVideo();\n    }\n  }\n\n  return (\n    <Container>\n      <LeftRow>\n        <Video muted autoPlay ref={userVideoRef} />\n        <Video muted autoPlay ref={partnerVideo} />\n      </LeftRow>\n      <RightRow>\n        <div id = \"host\">\n        <button onClick={(e)=>setVideohost(\"n\")}>Panopto</button>\n        <button onClick={(e)=>setVideohost(\"y\")}>Youtube</button>\n        </div>\n        <div id=\"player\" />\n        <div id=\"controls\">\n        <input\n          type=\"text\"\n          placeholder=\"video link\"\n          value={videoID}\n          onChange={(e) => setVideoID(e.target.value)}\n        />\n        <button id =\"loadVideo\" onClick={loadVideo}>Load video</button>\n        </div>\n      </RightRow>\n    </Container>\n  );\n};\n\nexport default Room;\n"]},"metadata":{},"sourceType":"module"}